<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8"/>
</head>
<body>
<div>
	Class 
	<select id="classSelector" onchange="updateClassFields()">
		<option value="Barbarian">Barbarian</option>
		<option value="Bard">Bard</option>
		<option value="Cleric">Cleric</option>
		<option value="Druid">Druid</option>
		<option value="Fighter">Fighter</option>
		<option value="Monk">Monk</option>
		<option value="Paladin">Paladin</option>
		<option value="Ranger">Ranger</option>
		<option value="Rogue">Rogue</option>
		<option value="Sorcerer">Sorcerer</option>
		<option value="Warlock">Warlock</option>
		<option value="Wizard">Wizard</option>
	</select>
</div>
<div>
	Level 
	<input type="text" name="level" maxlength="2" class="twoDigitInput" class="saveAttrib">
</div>
<div>
	Armor Class 
	<input type="text" name="armorClass" maxlength="2" class="twoDigitInput">
</div>
<div>
	Speed 
	<input type="text" name="speed" maxlength="2" class="twoDigitInput">
</div>
<div>
	Health 
	<input type="text" name="health" maxlength="2" class="twoDigitInput">
</div>
<div>
	Hit Dice = 
	<span id="hitDice"></span>
</div>
<br>
<div>
	<span class="attribTitle">Attributes = Save DC</span>
	<p style="margin-top: 0;">
		<span id="attribText">Strength</span>
		<input type="checkbox" id="Strength">
		<input type="text" name="strength" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="strSaveDC"></span>
	</p>
	<br>
	<p>
		<span id="attribText">Dexterity</span>
		<input type="checkbox" id="Dexterity">
		<input type="text" name="dexterity" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="dexSaveDC"></span>
	</p>
	<br>
	<p>
		<span id="attribText">Constitution</span>
		<input type="checkbox" id="Constitution">
		<input type="text" name="constitution" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="conSaveDC"></span>
	</p>
	<br>
	<p>
		<span id="attribText">Intelligence</span>
		<input type="checkbox" id="Intelligence">
		<input type="text" name="intelligence" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="intSaveDC"></span>
	</p>
	<br>
	<p>
		<span id="attribText">Wisdom</span>
		<input type="checkbox" id="Wisdom">
		<input type="text" name="wisdom" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="wisSaveDC"></span>
	</p>
	<br>
	<p>
		<span id="attribText">Charisma</span>
		<input type="checkbox" id="Charisma">
		<input type="text" name="charisma" maxlength="2" class="twoDigitInput" class="saveAttrib"> = 
		<span id="charSaveDC"></span>
</div>
<div>
	<span class="attribTitle">Proficiencies</span>
	<input type="checkbox" id="Athletics"> Athletics
	<br>
	<input type="checkbox" id="Acrobatics"> Acrobatics
	<br>
	<input type="checkbox" id="Sleight"> Sleight of Hand
	<br>
	<input type="checkbox" id="Stealth"> Stealth
	<br>
	<input type="checkbox" id="Arcana"> Arcana
	<br>
	<input type="checkbox" id="History"> History
	<br>
	<input type="checkbox" id="Investigation"> Investigation
	<br>
	<input type="checkbox" id="Nature"> Nature
	<br>
	<input type="checkbox" id="Religion"> Religion
	<br>
	<input type="checkbox" id="Animal"> Animal Handling
	<br>
	<input type="checkbox" id="Insight"> Insight
	<br>
	<input type="checkbox" id="Medicine"> Medicine
	<br>
	<input type="checkbox" id="Perception"> Perception
	<br>
	<input type="checkbox" id="Survival"> Survival
	<br>
	<input type="checkbox" id="Deception"> Deception
	<br>
	<input type="checkbox" id="Intimidation"> Intimidation
	<br>
	<input type="checkbox" id="Performance"> Performance
	<br>
	<input type="checkbox" id="Persuasion"> Persuasion
	<br>
</div>
<div>
	<input type="text" name="roll" id="diceRoll">
	<button onclick="calcRoll()">Roll</button>
	<button onclick="$('#diceRoll').val('')">Clear</button>
	<br>
	<select id="abil" class="inputSelectors">
		<option value="Athletics">Athletics</option>
		<option value="Acrobatics">Acrobatics</option>
		<option value="Sleight">Sleight</option>
		<option value="Stealth">Stealth</option>
		<option value="Arcana">Arcana</option>
		<option value="History">History</option>
		<option value="Investigation">Investigation</option>
		<option value="Nature">Nature</option>
		<option value="Religion">Religion</option>
		<option value="Animal">Animal Handling</option>
		<option value="Insight">Insight</option>
		<option value="Medicine">Medicine</option>
		<option value="Perception">Perception</option>
		<option value="Survival">Survival</option>
		<option value="Deception">Deception</option>
		<option value="Intimidation">Intimidation</option>
		<option value="Performance">Performance</option>
		<option value="Persuasion">Persuasion</option>
	</select>
	<button onclick="calcAbilityCheck()">Ability Check</button>
	<br>
	<select id="saving" class="inputSelectors">
		<option value="strength">Strength</option>
		<option value="dexterity">Dexterity</option>
		<option value="constitution">Constitution</option>
		<option value="intelligence">Intelligence</option>
		<option value="wisdom">Wisdom</option>
		<option value="charisma">Charisma</option>
	</select>
	<button onclick="calcSavingThrow()">Saving Throw</button>
	<p class="prevRoll">
		Current Roll
		<button onclick="$('#rollOutput').text('')">Clear</button>
	</p>
<p id="rollOutput"></p>
<p class="prevRoll">
	Previous Rolls
	<button onclick="$('#oldRolls').text('')">Clear</button>
</p>
<p id="oldRolls"></p>
</div>
</div>

<!-- save to file -->

<style type="text/css">
	html
	{
		font-family: "Verdana", Verdana, sans-serif;
	}
	input
	{
		font-size: 18px;
	}
	div
	{
		display: inline-block;
		word-break: keep-all;
	}
	select
	{
		font-size: 18px;
	}
	button
	{
		font-size: 18px;
	}
	.attribTitle
	{
		display: block;
		text-align: center;
		font-weight: bold;
		font-size: 18px;
		margin-top: 10px;
		margin-bottom: 10px;
	}
	.inputSelectors
	{
		font-size: 18px;
		width: 196px;
		margin-top: 15px;
	}
	#attribText
	{
		width: 100px;
		display: inline-block;
	}
	#longInput
	{
		width: 100px;
	}
	.twoDigitInput
	{
		width: 25px;
	}
	#alignInput
	{
		text-align: center;
	}
	.prevRoll
	{
		text-align: center;
		font-weight: bold;
		font-size: 18px;
	}
	#rollOutput
	{
		height: 50px;
		width: 450px;
		overflow-y: auto;
		border-style: solid;
		border-width: 2px;
		border-radius: 5px;
	}
	#oldRolls
	{
		height: 100px;
		width: 450px;
		overflow-y: auto;
		border-style: solid;
		border-width: 2px;
		border-radius: 5px;
	}
	p
	{
		margin-bottom: 10px; 
		margin-top: 10px;
	}
	#charName
	{
		display: block;
		text-align: center;
	}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

	$(document).ready(function() 
	{
		initFields();
		updateClassFields();
		$(".twoDigitInput").keydown(function(e)
		{
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
             // Allow: Ctrl/cmd+A
            (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+C
            (e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: Ctrl/cmd+X
            (e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true)) ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) 
            {
                 // let it happen, don't do anything
                 return;
	        }
	        // Ensure that it is a number and stop the keypress
	        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) 
	        && (e.keyCode < 96 || e.keyCode > 105)) 
	        {
	            e.preventDefault();
	        }
		});
		$("#diceRoll").keydown(function(e)
		{
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190, 32, 107, 109, 173, 68]) !== -1 
			||
             // Allow: Ctrl/cmd+A
            (e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true)) 
            ||
             // Allow: Ctrl/cmd+C
            (e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true)) 
            ||
             // Allow: Ctrl/cmd+X
            (e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true)) 
            ||
            (e.keyCode == 61 && e.shiftKey === true)
            ||
             // Allow: home, end, left, right
            (e.keyCode >= 35 && e.keyCode <= 39)) 
            {
                 // let it happen, don't do anything
                 return;
	        }
	        // Ensure that it is a number and stop the keypress
	        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) 
	        && (e.keyCode < 96 || e.keyCode > 105)) 
	        {
	            e.preventDefault();
	        }
		});
		$(".twoDigitInput").keyup(function () 
		{
			initFields();
			updateSaveDCs();
		});
	});

	function initFields()
	{
		if ($('[name="level"]').val().trim() == "")
		{
			$('[name="level"]').val("1");	
		}

		if ($('[name="strength"]').val().trim() == "")
		{
			$('[name="strength"]').val("10");
		}
		
		if ($('[name="dexterity"]').val().trim() == "")
		{
			$('[name="dexterity"]').val("10");
		}

		if ($('[name="constitution"]').val().trim() == "")
		{
			$('[name="constitution"]').val("10");
		}

		if ($('[name="intelligence"]').val().trim() == "")
		{
			$('[name="intelligence"]').val("10");
		}

		if ($('[name="wisdom"]').val().trim() == "")
		{
			$('[name="wisdom"]').val("10");
		}

		if ($('[name="charisma"]').val().trim() == "")
		{
			$('[name="charisma"]').val("10");
		}
	}

	function updateClassFields()
	{
		var classSelection = $("#classSelector").val();
		if (classSelection == "Barbarian")
		{
			$("#hitDice").text("d12");
		}
		else if ($.inArray(classSelection, ["Fighter", "Paladin", "Ranger", ]) !== -1)
		{
			$("#hitDice").text("d10");
		}
		else if ($.inArray(classSelection, ["Bard", "Cleric", "Druid", "Monk", "Rogue", "Warlock"]) !== -1)
		{
			$("#hitDice").text("d8");
		}
		else
		{
			$("#hitDice").text("d6");	
		}
		updateSaveDCs();
	}

	function updateSaveDCs()
	{
		var classSelection = $("#classSelector").val();
		var charLevel = parseInt($('[name="level"]').val());
		// proficiency bonus
		// str, dex, con, int, wis, cha
		var profBonusArray = [0, 0, 0, 0, 0, 0];
		if ($.inArray(classSelection, ["Barbarian", "Fighter"]) !== -1)
		{
			profBonusArray[0] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[2] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else if ($.inArray(classSelection, ["Cleric", "Paladin", "Warlock"]) !== -1)
		{
			profBonusArray[4] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[5] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else if ($.inArray(classSelection, ["Druid", "Wizard"]) !== -1)
		{
			profBonusArray[3] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[4] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else if ($.inArray(classSelection, ["Monk", "Ranger"]) !== -1)
		{
			profBonusArray[0] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[1] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else if (classSelection == "Bard")
		{
			profBonusArray[1] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[5] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else if (classSelection == "Rogue")
		{
			profBonusArray[1] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[3] = Math.floor((charLevel - 1) / 4) + 2;
		}
		else
		{
			profBonusArray[2] = Math.floor((charLevel - 1) / 4) + 2;
			profBonusArray[5] = Math.floor((charLevel - 1) / 4) + 2;
		}

		var abilityBonus = Math.floor(parseInt($('[name="strength"]').val()) / 2) - 5;

		var strengthSave = 8 + profBonusArray[0] + abilityBonus;

		abilityBonus = Math.floor(parseInt($('[name="dexterity"]').val()) / 2) - 5;

		var dexteritySave = 8 + profBonusArray[1] + abilityBonus;

		abilityBonus = Math.floor(parseInt($('[name="constitution"]').val()) / 2) - 5;

		var constitutionSave = 8 + profBonusArray[2] + abilityBonus;

		abilityBonus = Math.floor(parseInt($('[name="intelligence"]').val()) / 2) - 5;

		var intelligenceSave = 8 + profBonusArray[3] + abilityBonus;

		abilityBonus = Math.floor(parseInt($('[name="wisdom"]').val()) / 2) - 5;

		var wisdomSave = 8 + profBonusArray[4] + abilityBonus;

		abilityBonus = Math.floor(parseInt($('[name="charisma"]').val()) / 2) - 5;

		var charismaSave = 8 + profBonusArray[5] + abilityBonus;

		$("#strSaveDC").text(strengthSave.toString());
		$("#dexSaveDC").text(dexteritySave.toString());
		$("#conSaveDC").text(constitutionSave.toString());
		$("#intSaveDC").text(intelligenceSave.toString());
		$("#wisSaveDC").text(wisdomSave.toString());
		$("#charSaveDC").text(charismaSave.toString());
	}

	function calcAbilityCheck() 
	{
		var typeOfCheck = $("#abil").val();
		var abilSelector = "#" + typeOfCheck;
		var profBonus = 0;
		var abilityBonus = 0;
		
		if (document.getElementById(typeOfCheck).checked)
		{
			var charLevel = parseInt($('[name="level"]').val());
			profBonus = Math.floor((charLevel - 1) / 4) + 2;	
		}
		
		if (typeOfCheck == "Athletics")
		{
			var score = parseInt($('[name="strength"]').val());
			abilityBonus = Math.floor(score / 2) - 5;
		}
		else if ($.inArray(typeOfCheck, ["Acrobatics", "Sleight", "Stealth"]) !== -1)
		{
			var score = parseInt($('[name="dexterity"]').val());
			abilityBonus = Math.floor(score / 2) - 5;
		}
		else if ($.inArray(typeOfCheck, ["Arcana", "History", "Investigation", "Nature", "Religion"]) !== -1)
		{
			var score = parseInt($('[name="intelligence"]').val());
			abilityBonus = Math.floor(score / 2) - 5;
		}
		else if ($.inArray(typeOfCheck, ["Animal", "Insight", "Medicine", "Perception", "Survival"]) !== -1)
		{
			var score = parseInt($('[name="wisdom"]').val());
			abilityBonus = Math.floor(score / 2) - 5;
		}
		else if ($.inArray(typeOfCheck, ["Deception", "Intimidation", "Performance", "Persuasion"]) !== -1)
		{
			var score = parseInt($('[name="charisma"]').val());
			abilityBonus = Math.floor(score / 2) - 5;
		}
		
		var roll = getRandomInteger(1, 20);
		var check = roll + abilityBonus + profBonus;

		if (typeOfCheck == "Sleight")
		{
			typeOfCheck = "Sleight of Hand";
		}
		else if (typeOfCheck == "Animal")
		{
			typeOfCheck = "Animal Handling";
		}

		updateRollLog( typeOfCheck + " = " + roll.toString() + " (d20) + " + abilityBonus.toString() + " + " + profBonus.toString() + " = " + check.toString());
	}

	function calcSavingThrow() 
	{
		var typeOfSave = $("#saving").val();
		var saveType = typeOfSave.charAt(0).toUpperCase() + typeOfSave.substr(1);
		var score = parseInt($('[name="' + typeOfSave + '"]').val());
		var abilityBonus = Math.floor(score / 2) - 5;
		var roll = getRandomInteger(1, 20);
		var profBonus = 0;
		if (document.getElementById(saveType).checked)
		{
			var charLevel = parseInt($('[name="level"]').val());
			profBonus = Math.floor((charLevel - 1) / 4) + 2;
		}
		var check = roll + abilityBonus + profBonus;

		updateRollLog( saveType + " = " + roll.toString() + " (d20) + " + abilityBonus.toString() + " + " + profBonus.toString() + " = " + check.toString());
	}

	function calcRoll() 
	{
		const MINUS_OR_PLUS_WAS_LAST = false;
		const ROLL_WAS_LAST = true;
		var rolls = $("#diceRoll").val().trim().split(" ");
		var rollsOutput = "";
		var isPositive = true;
		var totalRoll = 0;
		var lastToken = false;

		for (var i = 0; i < rolls.length; ++i)
		{
			if (rolls[i] == "+")
			{
				if (lastToken == MINUS_OR_PLUS_WAS_LAST)
				{
					updateRollLog("Incorrect Roll Syntax");
					return;
				}
				lastToken = MINUS_OR_PLUS_WAS_LAST;
				isPositive = true;
				rollsOutput += " + ";
			}
			else if (rolls[i] == "-")
			{
				if (lastToken == MINUS_OR_PLUS_WAS_LAST)
				{
					updateRollLog("Incorrect Roll Syntax");
					return;
				}
				lastToken = MINUS_OR_PLUS_WAS_LAST;
				isPositive = false;
				rollsOutput += " - ";
			}
			else
			{
				if (lastToken == ROLL_WAS_LAST)
				{
					updateRollLog("Incorrect Roll Syntax");
					return;
				}
				lastToken = ROLL_WAS_LAST;
				var j = 0;
				var firstNumber = "";

				for (; j < rolls[i].length; ++j)
				{
					if (isInteger(rolls[i][j]))
					{
						firstNumber = firstNumber + rolls[i][j];
					}
					else if (rolls[i][j] == "d")
					{
						++j;
						break;
					}
					else
					{
						updateRollLog("Incorrect Roll Syntax");
						return;
					}
				}

				var fNumber = 1;
				if (firstNumber.length > 0)
				{
					fNumber = parseInt(firstNumber);
					if (j == rolls[i].length)
					{
						totalRoll += (isPositive ? fNumber : -fNumber);
						rollsOutput += firstNumber;
						continue;
					}
				}
				
				var secondNumber = "";
				for (; j < rolls[i].length; ++j)
				{
					if (isInteger(rolls[i][j]))
					{
						secondNumber = secondNumber + rolls[i][j];
					}
					else
					{
						updateRollLog("Incorrect Roll Syntax");
						return;
					}
				}

				if (secondNumber.length == 0)
				{
					updateRollLog("Incorrect Roll Syntax");
					return;
				}
				else
				{
					var sNumber = parseInt(secondNumber);
					var currentRolls = 0;
					rollsOutput += "( " + firstNumber + "d" + secondNumber + " = ";
					for (var k = 0; k < fNumber; ++k)
					{
						var currentRoll = getRandomInteger(1, sNumber);

						if (k == 0)
						{
							rollsOutput += currentRoll.toString();
						}
						else
						{
							rollsOutput += " + " + currentRoll.toString();
						}

						currentRolls += currentRoll;
					}
					if (fNumber > 1)
					{
						rollsOutput += " ) " + currentRolls;
					}
					else
					{
						rollsOutput += " )";
					}
					
					totalRoll += (isPositive ? currentRolls : -currentRolls);
				}
			}
		}
		rollsOutput += " = " + totalRoll.toString();
		updateRollLog(rollsOutput);
	}

	function isInteger(char)
	{
		if ($.inArray(char, ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9']) !== -1)
		{
			return true;
		}
		else
		{
			return false;
		}
	}

	function updateRollLog(output)
	{
		$("#oldRolls").prepend($("#rollOutput").text() + "<br>");

		$("#rollOutput").text(output);
	}

	function getRandomInteger(min, max)
	{
		return Math.floor(Math.random() * (max - min + 1)) + min;
	}
</script>
<a href="http://zrzuch.github.io/">Return To Home</a>
</body>
</html>